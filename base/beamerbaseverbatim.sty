\ProvidesPackageRCS $Header$

% Copyright 2003 by Till Tantau <tantau@users.sourceforge.net>.
%
% This program can be redistributed and/or modified under the terms
% of the GNU Public License, version 2.

\mode<presentation>


\newwrite\beamer@verbatimfileout

\def\beamer@verbatimreadframe{%
  \immediate\openout\beamer@verbatimfileout=\jobname.vrb%
  \begingroup%
  \let\do\beamer@makeinnocent\dospecials%
  \beamer@makeinnocent\^^L% and whatever other special cases
  \endlinechar`\^^M \catcode`\^^M=12 \beamer@processframeline}

{\catcode`\^^M=12\endlinechar=-1%
  \long\gdef\beamer@processframeline#1^^M{%
    \def\beamer@test{#1}%
    \ifx\beamer@test\beamer@stopframe%
      \let\next=\beamer@framewritten%
    \else
      \immediate\write\beamer@verbatimfileout{#1}%  
      \let\next=\beamer@processframeline%
    \fi%
    \next%
  }
}

{\escapechar=-1\relax%
  \xdef\beamer@stopframe{\string\\end\string\{frame\string\}}
}

\def\beamer@framewritten{\endgroup%
  \immediate\closeout\beamer@verbatimfileout%
  \beamer@afterexternalframe%
}



%
%
% Verbatim overlay support
%
%

\mode
<all>
{
  \let\beamer@verb@egroup=\verb@egroup

  \def\beamer@setb{\setbox0=\copy}
  \long\def\defverb#1{%
    \expandafter\newbox\csname @verb\string#1\endcsname%
    \def#1{{\expandafter\beamer@setb\csname
        @verb\string#1\endcsname\unhbox0}}%
    \def\verb@egroup{\global\let\verb@balance@group\@empty\egroup\egroup\let\verb@egroup=\beamer@verb@egroup}
    \expandafter\setbox\csname @verb\string#1\endcsname=\hbox\bgroup
    \verb}

  \define@key{beamerverb}{colored}[true]{\def\beamer@colorsup{}}
  \define@key{beamerverb}{width}{\def\beamer@verbwidth{#1}}
  
  \newcommand{\defverbatim}[2][]{%
    \def\beamer@colorsup{\def\set@color{}\def\reset@color{}}%
    \setkeys{beamerverb}{width=\textwidth}%
    \setkeys{beamerverb}{#1}%
    \expandafter\newbox\csname @verb\string#2\endcsname%
    \def#2{{\expandafter\beamer@setb\csname @verb\string#2\endcsname%
        \unvbox0}\color{.}}%
    \expandafter\setbox\csname @verb\string#2\endcsname=\vbox\bgroup%
    \beamer@colorsup%
    \hsize=\beamer@verbwidth\textwidth=\beamer@verbwidth\linewidth=\beamer@verbwidth%
    \vskip-\baselineskip\strut\bgroup\aftergroup\beamer@verbend%
    \let\@next=}
  \def\beamer@verbend{\vskip-\baselineskip\strut\egroup}
}




\mode
<all>
% End in common mode


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "~/texmf/tex/latex/beamer/examples/beamerexample1.tex"
%%% End: 
